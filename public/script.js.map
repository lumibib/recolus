{"version":3,"file":"script.js","sources":["../resources/scripts/script.js"],"sourcesContent":["(function (window) {\n\n    /**\n     * Console Warning function\n     * Source: https://github.com/simpleanalytics/scripts/blob/ed9efd1b5ff62f27e0dc395d57068ac6a0517d14/dist/latest/latest.dev.js\n     * @param {String} message\n     * @returns {?Function} warn\n     */\n     const warn = function (message) {\n        if (console && console.warn) console.warn('Recolus Script: ', message);\n    };\n\n    /**\n     * Looks for an element with Recolus attributes and get them.\n     * Warn and fail if missing.\n     */\n     const script = document.querySelector('script[data-recolus-site-id]');\n     if (!script) {warn('No script found.'); return;};\n\n     const attr = script.getAttribute.bind(script);\n     const siteId = attr('data-recolus-site-id');\n     const hostUrl = attr('data-recolus-host-url');\n     if (!siteId) {warn('No site id found.'); return;};\n     if (!hostUrl) {warn('No host url found.'); return;};\n\n     if (!document.doctype) {warn('Add DOCTYPE html for more accurate dimensions.')};\n\n     /**\n      * Get script attributes options.\n      */\n     const customDomain = attr('data-recolus-domain') || '';\n     const customVariable = attr('data-recolus-variable') || '';\n\n    /**\n     * Declare global window variables.\n     */\n    var wlocation = window.location;\n    var wdocument = window.document;\n    var wnavigator = window.navigator;\n    var whistory = window.history;\n    var scrolled = 0;\n    var rid = null;\n\n    /**\n     * Declare Recolus attributes.\n     * @returns {Object} attributes\n     */\n     const recolusAttributes = {\n        siteId: siteId,\n        hostUrl: hostUrl,\n        customDomain: customDomain,\n        customVariable: customVariable,\n     };\n\n    /**\n     * Construct URL to the API endpoint of Recolus.\n     * @param {String} host - URL of the Recolus server host.\n     * @returns {String} endpoint - URL to the API endpoint of the Recolus server host.\n     */\n    const endpoint = function(hostUrl) {\n        const hasTrailingSlash = hostUrl.substring(-1) === '/'\n        return hostUrl + (hasTrailingSlash === true ? '' : '/') + 'api/collect'\n    }\n\n    /**\n     * Determines if user agent is a bot. Approach is to get most bots, assuming other bots don't run JS.\n     * Source: https://stackoverflow.com/questions/20084513/detect-search-crawlers-via-javascript/20084661\n     * @param {String} userAgent - User agent that should be tested.\n     * @returns {Boolean} isBot\n     */\n    const isBot = function(userAgent) {\n        const checkNav = navigator.webdriver ||\n        window.__nightmare ||\n        \"callPhantom\" in window ||\n        \"_phantom\" in window ||\n        \"phantom\" in window;\n\n        const testUa = (/bot|crawler|crawl|spider|crawling/i).test(userAgent);\n\n        return checkNav ?? testUa;\n    }\n\n    /**\n     * Checks if the website is in background (e.g. user has minimzed or switched tabs).\n     * @returns {boolean}\n     */\n    const isInBackground = function() {\n        return document.visibilityState === 'hidden';\n    }\n\n    /**\n     * Checks if the website is in local.\n     * Source: https://beampipe.io/js/tracker.js\n     * @param {String} host - URL host (window.location.hostname).\n     * @returns {boolean}\n     */\n    const isLocal = function(host) {\n        var test = /^localhost$|^127(?:\\.[0-9]+){0,2}\\.[0-9]+$|^(?:0*\\:)*?:?0*1$/.test(location.hostname) || location.protocol === \"file:\";\n        if (test) {warn('Run from local or file host.')};\n        return test;\n    }\n\n    /**\n     * Create a UUID v4.\n     * Source : https://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid\n     * @returns {String} uuid.\n     */\n    const uuid = function () {\n        return ([1e7] + -1e3 + -4e3 + -8e3 + -1e11).replace(/[018]/g, c =>\n            (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)\n        );\n    }\n\n    /**\n     * Create a now date.\n     * @returns {Date} now.\n     */\n     const now = function () {\n        return Date.now;;\n    }\n    /**\n     * Skip your own views with an URL hash.\n     * Source : https://gc.zgo.at/count.js\n     */\n    const toggleWithHash = function () {\n        if (location.hash === '#toggle-recolus') {\n            if (localStorage.getItem('skiprecolus') === '1') {\n                localStorage.removeItem('skiprecolus', '1')\n                alert('Recolus is now ENABLED in this browser.')\n            } else {\n                localStorage.setItem('skiprecolus', '1')\n                alert('Recolus is now DISABLED in this browser until ' + location + ' is loaded again.')\n                warn('Disabled. Recolus is now DISABLED in this browser until ' + location + ' is loaded again.');\n                return;\n            }\n        }\n    }\n\n    /**\n     * Create and store rid for reuse.\n     */\n     var getRid = function () {\n        if (rid == null) {\n            rid = uuid();\n            return rid;\n        } else {\n            return rid;\n        }\n    }\n\n    /**\n     * Gathers all platform-, screen- and user-related information.\n     * @param {Boolean} detailed - Include personal data.\n     * @returns {Object} attributes - User-related information.\n     */\n    const informations = function() {\n        const userAgent = navigator.userAgent;\n        const language = (navigator.language || navigator.userLanguage).substr(0, 2);\n\n        var timezone;\n        try { timezone = Intl.DateTimeFormat().resolvedOptions().timeZone; } catch (e) { /* Do nothing */ }\n\n        const data = {\n            type: 'page',\n            siteId: recolusAttributes.siteId,\n            rid: getRid(),\n            url: location.href,\n            host: location.host,\n            hostname: location.hostname,\n            protocol: location.protocol,\n            path: location.pathname,\n            query: location.search,\n            fragment: location.hash,\n            title: document.title,\n            referrer: document.referrer,\n            language: language,\n            userAgent: userAgent,\n            timezone: timezone,\n            windowWidth: window.innerWidth,\n            windowHeight: window.innerHeight,\n            screenWidth: window.screen.width,\n            screenHeight: window.screen.height,\n            customDomain: recolusAttributes.customDomain,\n            customVariable: recolusAttributes.customVariable,\n        }\n\n        return data;\n    }\n\n    /**\n     * Sends a POST request to a specified URL.\n     * Won't catch all errors as some are already logged by the browser.\n     * In this case the callback won't fire.\n     * @param {String} url - URL to the API endpoint of the Recolus server.\n     * @param {Object} body - JSON which will be send to the server.\n     */\n    const send = function (url, body) {\n\n        // console.log(body);\n\n        let xhr = new XMLHttpRequest();\n        xhr.open('POST', url);\n        xhr.setRequestHeader(\"Accept\", \"application/json\");\n        xhr.setRequestHeader(\"Content-Type\", \"application/json\");\n\n        xhr.onreadystatechange = function () {\n            if (xhr.readyState === 4 && xhr.status !== 201) {\n                warn('Conncetion error with status ' + xhr.status + ' and message: \"' + JSON.parse(xhr.responseText)?.message + '\"');\n                warn('Conncetion error with response ' + xhr.responseText);\n            }\n        };\n        xhr.send(JSON.stringify(body));\n    }\n\n    /**\n     * Sends a beacon request to a specified URL.\n     * Won't catch errors.\n     * @param {String} url - URL to the API endpoint of the Recolus server.\n     * @param {Object} body - JSON which will be send to the server.\n     */\n     const sendBeacon = function (url, data) {\n        var text = JSON.stringify(data);\n        //const blob = new Blob([JSON.stringify(body)], { type: 'application/json; charset=UTF-8' });\n        console.log(text);\n        navigator.sendBeacon(url, text);\n     }\n\n    /**\n     * Go.\n     * Check, filter and send informations.\n     */\n    toggleWithHash();\n\n    if (isBot() || isInBackground() || isLocal()) {\n        warn('Page count not send. Is a bot, in background or local.');\n        return;\n    }\n\n    send(endpoint(recolusAttributes.hostUrl), informations())\n\n    /**\n     * Scroll.\n     * Get document height.\n     */\n    function documentHeight() {\n        let D = window.document;\n        return Math.max(\n            D.body.scrollHeight, D.documentElement.scrollHeight,\n            D.body.offsetHeight, D.documentElement.offsetHeight,\n            D.body.clientHeight, D.documentElement.clientHeight\n        );\n    }\n\n    /**\n     * Scroll.\n     * Get current scroll position.\n     */\n    function positionScroll(){\n        var winheight = window.innerHeight || (document.documentElement || document.body).clientHeight;\n        var docheight = documentHeight();\n\n        var scrollTop = window.pageYOffset || (document.documentElement || document.body.parentNode || document.body).scrollTop;\n        var trackLength = docheight - winheight;\n        var pctScrolled = Math.floor(scrollTop / trackLength * 100);\n\n        return pctScrolled;\n    }\n\n    /**\n     * Scroll.\n     * After document loaded. Calculate max scrolled position.\n     */\n    window.addEventListener(\"load\", function () {\n        scrolled = positionScroll();\n        window.addEventListener(\"scroll\", function () {\n            if (scrolled < positionScroll()) {scrolled = positionScroll()};\n        }, false);\n    });\n\n    /**\n     * Scroll.\n     * Calculate scroll.\n     */\n     var scroll = function () {\n         return Math.max(0, scrolled, positionScroll());\n     };\n\n    /**\n     * Duration.\n     * Initializes Variables.\n     * Source : https://gist.github.com/imkevinxu/4393523\n     */\n\n     var durationHidden, durationState, durationVisibilityChange,\n         _this = this;\n\n     if (document.hidden != null) {\n        durationHidden = \"hidden\";\n         durationVisibilityChange = \"visibilitychange\";\n         durationState = \"visibilityState\";\n     } else if (document.mozHidden != null) {\n        durationHidden = \"mozHidden\";\n         durationVisibilityChange = \"mozvisibilitychange\";\n         durationState = \"mozVisibilityState\";\n     } else if (document.msHidden != null) {\n        durationHidden = \"msHidden\";\n         durationVisibilityChange = \"msvisibilitychange\";\n         durationState = \"msVisibilityState\";\n     } else if (document.webkitHidden != null) {\n        durationHidden = \"webkitHidden\";\n         durationVisibilityChange = \"webkitvisibilitychange\";\n         durationState = \"webkitVisibilityState\";\n     }\n\n     this.d = new Date();\n     this.new_d = new Date();\n\n     var totalDuration = 0;\n\n    /**\n     * Duration.\n     * Calculates Time Spent on page upon leaving/closing page\n     * Source : https://gist.github.com/imkevinxu/4393523\n     */\n     window.onunload = function () {\n         _this.new_d = new Date();\n         var time_spent = Math.round((_this.new_d - _this.d) / 1000);\n         calculateTotalDuration(time_spent);\n     };\n\n    /**\n     * Duration.\n     * Calculates Time Spent on page upon unfocusing tab\n     * Source : http://davidwalsh.name/page-visibility\n     */\n     document.addEventListener(durationVisibilityChange, (function (e) {\n         if (document[durationState] === 'visible') {\n             _this.d = new Date();\n         } else if (document[durationHidden]) {\n             _this.new_d = new Date();\n             var time_spent = Math.round((_this.new_d - _this.d) / 1000);\n             calculateTotalDuration(time_spent);\n         }\n     }), false);\n\n     /**\n     * Duration and trigger update record.\n     * Calculate total duration and max scroll.\n     * Prepare pdate record beacon.\n     */\n     var calculateTotalDuration = function (intervalTimeSpent) {\n         if (intervalTimeSpent >= 1) {\n             totalDuration += intervalTimeSpent;\n\n             // console.log(totalDuration);\n             // console.log('scroll : '+ scroll());\n\n             updateRecord(getRid(), totalDuration, scroll());\n         }\n     }\n\n     /**\n      * Duration and scroll.\n      * Update record before page leave.\n      */\n      var updateRecord = function (rid, duration, scroll) {\n\n         let data = {\n             rid: rid,\n             duration: duration,\n             scroll: scroll,\n         };\n\n         sendBeacon(endpoint(recolusAttributes.hostUrl) + '-update', data);\n     };\n\n\n})(window);\n"],"names":[],"mappings":"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"}